<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../elements/feadr-post-overview.html">
<link rel="import" href="../feadr-app/shared-styles.html">

<dom-module id="feadr-page-discover">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 4px;
      }

      paper-card {
        width: 100%;
        margin: 2px 0;
      }
    </style>
    <div class="container">
      <template is="dom-repeat" items="[[posts]]" as="post">
        <paper-card>
          <feadr-post-overview class="post"
                               title="[[post.title]]"
                               username="[[post.username]]"
                               location="[[post.location.name]]"
                               time="[[post.time]]"
                               points="[[post.points]]"
                               thumbnail="[[post.thumbnail]]">
          </feadr-post-overview>
        </paper-card>
      </template>
    </div>
  </template>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDj-3e4yAdHW7g6tKt4RPXxvz_NxrNXAOg&libraries=geometry"></script>
  <script>
    class FeadrDiscover extends Polymer.Element {
        static get is() {
            return 'feadr-page-discover';
        }

        static get properties() {
            return {
                posts: {
                    type: Array,
                    value: [],
                    notify: true,
                },
            };
        }

        ready() {
            super.ready();
            // let maxdistance = 15;
            // eslint-disable-next-line
            database.ref('overview').on('child_added', (snapshot) => {
                let lat = snapshot.val().location.lat;
                let long = snapshot.val().location.long;
                if(long > 0 || long < 0 || lat > 0 || lat < 0) {
                    console.log('something in between');
                    if(calculateDistanceBetween(lat, long) < 15) {
                        console.log('something something');
                        this.push('posts', snapshot.val());
                    }
                }
            });
            function calculateDistanceBetween(lat, long) {
                // eslint-disable-next-line
                const mainLocation = new google.maps.LatLng(52.778217, 6.912128);
                // eslint-disable-next-line
                let nearbyLocation = new google.maps.LatLng(lat, long);
                return calcDistance(mainLocation, nearbyLocation);
                function calcDistance(mainLocation, nearbyLocation) {
                    // eslint-disable-next-line
                    return (google.maps.geometry.spherical.computeDistanceBetween(mainLocation, nearbyLocation) / 1000).toFixed(2);
                }
            }
        }
    }
    window.customElements.define(FeadrDiscover.is, FeadrDiscover);
  </script>
</dom-module>
